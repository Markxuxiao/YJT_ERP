<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <meta name="description" content="万维软件新界面">

        <title>Anywell - 万维软件</title>

        <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/core.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/components.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/pages.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/responsive.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/index.css" rel="stylesheet" type="text/css" />

        <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="assets/js/modernizr.min.js"></script>


    </head>

    <body class="fixed-left">

        <!-- Start content -->
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="portlet">
                            <div class="portlet-heading portlet-default m-b-10">
                                <h3 class="portlet-title text-dark">
                                    智能体检
                                </h3>
                                <!-- <div class="portlet-widgets">
                                    <a href="javascript:;">更多 <i class="fa  fa-angle-double-right"></i></a>
                                </div> -->
                                <div class="clearfix"></div>
                            </div>
                            
                        </div>
                    </div>
                </div>
                <div id="masonry" class="row">
 
                </div>

            </div> <!-- container -->

        </div> <!-- content -->

        <!-- searchPage.js 滚动加载必备 loading按钮自己通过样式调整 -->
        <div id="imloading" style="width:150px;height:30px;line-height:30px;font-size:16px;text-align:center;border-radius:3px;opacity:0.7;background:#000;margin:10px auto 30px;color:#fff;display:none">
           <i class="fa fa-spinner fa-spin"></i>
           <span>  Loading.....</span>
        </div>
        <!-- 不用前端渲染可删除 -->
        <script id="template_item" type="text/html">
            {{each list as value i}}
                <div class="item col-xs-12 col-sm-6 col-md-6 col-lg-4">
                    <div class="portlet thumbnail">
                        <div class="portlet-heading portlet-default">
                            <h3 class="portlet-title text-dark">
                                {{value.name}}
                            </h3>
                            <div class="portlet-widgets">
                                <a href="#" data-toggle=""><i class="ion-ios7-star"></i></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="panel-collapse collapse in">
                            <div class="portlet-body">
                                <div style="width: 100%;text-align: center;">
                                  <span>当前值：{{value.value}}</span>
                                </div>
                                <div id="{{value.id}}" style="width: 300px;height:250px; background: #ccc;margin: 0 auto;" ></div>
                                <span style="position: absolute; bottom: 60px;left: 30px;font-size: 12px;color: #666;"><i class="fa fa-warning fa-fw" style="color: red;"></i> 警报值：{{value.data1}}</span>
                                <span style="position: absolute; bottom: 37px;left: 30px;font-size: 12px;color: #666;"><i class="fa fa-check-circle fa-fw" style="color: green;"></i> 达标值：{{value.data3}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            {{/each}}
        </script>
        <!-- end 不用前端渲染可删除 -->

        <!-- common js  -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
        <script src="assets/js/jquery.core.js"></script>
        <!-- jQueryPlugin  -->
        <!-- <script src="assets/js/masonry-docs.min.js"></script> -->
        <script src="assets/js/imagesLoaded.js"></script>
        <script src="assets/js/masonry.pkgd.min.js"></script>
        <!-- 不用前端渲染可删除 -->
        <script src="assets/js/template.js"></script>
        <script src="assets/plugins/echarts.simple.min.js"></script>
        <!-- end 不用前端渲染可删除 -->
        <!-- page js  -->
        <script src="assets/pages/masonryOnScroll.js"></script>
        <script type="text/javascript">
        // 不用前端渲染可删除
            var ajax_list = {};
                ajax_list.page_index =0;
                ajax_list.api = 'page2.aspx';

            var first_init = true;//初始化使用一次

             // 初始化瀑布流
             var $masonry = $('#masonry');
             //浏览器支持检测
            if (Modernizr.smil) {
                 var masonry_opt = {itemSelector: '.item',columnWidth: '.item'}; //现代浏览器
            } else {
                var masonry_opt = {itemSelector: '.item',columnWidth: '.item',gutter: 15};//IE10以下
            }


            // ajax 返回的data对象格式
            var fn_data = (function(){
              var i = 1;
              return function(){
                i++;
                return {
                    list: [
                        {'name':'月度计划完成率','value':'84243','data1':60000.00,'data3':100000.00,"id":"echart1" + i*10}
                       ,{'name':'月度计划完成率1','value':'65443','data1':60000.00,'data3':100000.00,"id":"echart2"+ i*10}
                       ,{'name':'月度计划完成率2','value':'35432','data1':60000.00,'data3':100000.00,"id":"echart3"+ i*10}
                       ,{'name':'月度计划完成率3','value':'74243','data1':60000.00,'data3':100000.00,"id":"echart4"+ i*10}
                       ,{'name':'月度计划完成率4','value':'54243','data1':60000.00,'data3':100000.00,"id":"echart5"+ i*10}
                       ,{'name':'月度计划完成率5','value':'34243','data1':60000.00,'data3':100000.00,"id":"echart6"+ i*10}
                       ,{'name':'月度计划完成率6','value':'34243','data1':60000.00,'data3':100000.00,"id":"echart7"+ i*10}
                       ,{'name':'月度计划完成率7','value':'34243','data1':60000.00,'data3':100000.00,"id":"echart8"+ i*10}
                       ,{'name':'月度计划完成率8','value':'34243','data1':60000.00,'data3':100000.00,"id":"echart9"+ i*10}
                    ],
                    msg:1
                };
              }
            })();


            $(function(){
                'use strict';
                /**
                 * echarts_factory
                 * @param {obj} op
                 *  参数说明
                 *  var op = {
                 *    domId:"echart",
                 *    data:[
                 *          {value:8223, name:'已完成'},
                 *          {value:1832, name:'差额'}
                 *        ]
                 *  };
                 */
                function echarts_factory(op){
                  var myChart = echarts.init(document.getElementById(op.domId));
                  var option = {
                        series : [
                          {
                            name: '完成率',
                            type: 'pie',
                            radius : '45%',
                            center: ['50%', '45%'],
                            label:{
                              normal:{
                                formatter:'{b}\n{d}%'
                              }
                            },
                            data:op.data
                          }
                        ],
                        color: ['rgb(254,67,101)','rgb(252,157,154)']
                    };
                  myChart.setOption(option);
                  return myChart;
                }
                // 渲染列表上的饼图
                // data 为ajax 返回的data.list对象
                function rander_echarts_list(data){
                  for(var i in data){
                    var id = data[i].id,
                        v1 = data[i].value,
                        v2 = data[i].data3 - data[i].value; 
                    var op = {
                      domId:id,
                      data:[
                            {value:v1, name:'已完成'},
                            {value:v2, name:'未完成'}
                          ]
                    };
                    echarts_factory(op)
                  }
                }

                function addItems() {
                  //$.post(ajax_list.api,{page:ajax_list.page_index},function(data){
                    //var data = {list:[{},{},{},{},{}],msg:1};
                    //上锁了就退出
                    if(!$('#imloading').data("on"))return;

                    var data = fn_data();
                    $('#imloading').data("on",false).fadeIn(800);

                    setTimeout(function(){ //ajax 成功回掉
                        //没有返回数据的情况
                      if(!data){
                        $('#imloading').data("on",false).find('i').hide().end().find('span').text('没有更多了！').fadeIn(800);
                        return;
                      }
                      var html = template('template_item',data);
                      var $newDom = $($.parseHTML(html)).appendTo($masonry);
                       $newDom.imagesLoaded(function() {
                          $masonry.masonry( 'appended', $newDom,true);
                       });
                      //渲染饼图
                      rander_echarts_list(data.list);
                      ajax_list.page_index++;//页数加1
                      $('#imloading').data("on",true).fadeOut();

                      //页面初始化执行一次
                      if (first_init) {
                        $masonry.imagesLoaded(function() {
                            $masonry.masonry(masonry_opt);
                        });
                        // 滚动加载瀑布流
                        // 接口示例
                        // var defaluts = {
                        //     container: $('#masonry'),
                        //     item : '.item',//滚动加载容器item
                        //     loading : $('#imloading'),//加载提示dom
                        //     max_item : 999, //最大条数
                        //     scroll_distance :50, //距离下边多少距离加载
                        //     callback: null
                        //   };
                        $masonry.masonryOnScroll({callback:function(){
                                addItems();
                        }});
                        first_init = !first_init;
                      }


                    },3000)
                    
                  //});
                }
                // 初始化加载
                addItems();

            });
        </script>
    </body>
</html>